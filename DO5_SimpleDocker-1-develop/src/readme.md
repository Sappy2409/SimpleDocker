#Simple Docker

Введение в докер. Разработка простого докер образа для собственного сервера.

## Part 1. Готовый докер

##### 1) Взял официальный докер образ с nginx и выкачал его при помощи docker pull

![part1.1](images/part1.1.png)

Рис. 1 Подгрузка образа с nginx

##### 2) Проверил наличие докер образа через docker images

![part1.2](images/part1.2.png)

Рис. 2 Применение docker images для проверки наличия образов

##### 3) Запустил докер образ через docker run -d nginx

![part1.3](images/part1.3.png)

Рис. 3 Запуск образа при помощи docker run -d nginx

##### 4) Проверил, что образ запустился через docker ps

![part1.4](images/part1.4.png)

Рис. 4 Проверка запущенных образов

##### 5) Посмотреть информацию о контейнере через docker inspect [container_id|container_name] (в моём случае имя контейнера "awesome_pascal")

![part1.5](images/part1.5.png)

Рис. 5 Частичная информация о контейнере awesome_pascal

##### 6) По выводу команды определил и поместил в отчёт размер контейнера, список замапленных портов и ip контейнера

![part1.6](images/part1.6.png)

Рис. 6 Размер контейнера 

![part1.7](images/part1.7.png)

Рис. 7 Список замапленных портов

![part1.8](images/part1.8.png)

Рис. 8 ip контейнера

##### 7) Остановил докер образ через docker stop и проверил, что образ остановился через docker ps

![part1.9](images/part1.9.png)

Рис. 9 Остановка образа и проверка остановки

##### 8) Запустил докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду run

![part1.10](images/part1.10.png)

Рис. 10 Запуск докера с необходимыми замапленными портами

##### 9) Проверил, что в браузере по адресу localhost:80 доступна стартовая страница nginx

![part1.11](images/part1.11.png)

Рис. 11 Адрес localhost:80 в браузере

##### 10) Перезапустил докер контейнер через docker restart [container_id|container_name] (теперь имя контейнера eager_burnell) и проверил запуск при помощи docker ps

![part1.12](images/part1.12.png)

Рис. 12 Перезапуск докера и проверка перезапуска

## Part 2. Операции с контейнером

##### 1) Прочитал конфигурационный файл nginx.conf внутри докер контейнера через команду exec

###### Exec отвечает за запуск команды внутри запущенного контейнера

![part2.1](images/part2.1.png)

Рис. 13 Содержание конфигурационного файла nginx.conf внутри контейнера

##### 2) Создал на локальной машине файл nginx.conf. Настроил в нем по пути /status отдачу страницы статуса сервера nginx

![part2.2](images/part2.2.png)

Рис. 14 Содержание конфигурационного файла nginx.conf на локальной машине 

##### 3) Скопировал созданный файл nginx.conf внутрь докер образа через команду docker cp. 

![part2.3](images/part2.3.png)

Рис. 15  Копирование файла внутрь докер образа

##### 4) Перезапустил nginx внутри докер образа через команду exec.

![part2.4](images/part2.4.png)

Рис. 16 Перезапуск nginx через exec

##### 5) Проверил, что по адресу localhost:80/status отдается страничка со статусом сервера nginx

![part2.5](images/part2.5.png)

Рис. 17 Страница localhost:80/status

##### 6) Экспортировал контейнер в файл container.tar через команду export

![part2.6](images/part2.6.png)

Рис. 18 Экспорт контейнера

##### 7) Остановил контейнер

![part2.7](images/part2.7.png)

Рис. 19 Остановка контейнера

##### 8) Удалил образ через docker rmi [image_id|repository], не удаляя перед этим контейнеры

![part2.8](images/part2.8.png)

Рис. 20 Удаление образа

##### 9) Удалил установленный контейнер

![part2.9](images/part2.9.png)

Рис. 21 Удаление контейнера

##### 10) Импортировал контейнер обратно через команду import

![part2.10](images/part2.10.png)

Рис. 22 Импорт контейнера

##### 11) Запустил импортированный контейнер 

![part2.11](images/part2.11.png)

Рис. 23 Запуск контейнера

##### 12) Проверил, что по адресу localhost:80/status отдаётся страничка со статусом сервера nginx

![part2.12](images/part2.12.png)

Рис. 23 Проверка адреса через терминал

![part2.13](images/part2.13.png)

Рис. 24 Проверка адреса через браузер

# Следующие задания необязательно вставлять в отчёт, но на всякий случай сделал

## Part 3. Мини веб-сервер

##### 1) Написал мини сервер на C и FastCgi, который будет возвращать простейшую страничку с надписью Hello World!

![part3.1](images/part3.1.png)

Рис. 25 Мини сервер для Hello World!

##### 2) Запустил написанный мини сервер через spawn-fcgi на порту 8080

![part3.2](images/part3.2.png)

Рис. 26 Запуск мини сервера

##### 3) Написал свой nginx.conf, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080

![part3.3](images/part3.3.png)

Рис. 27 Конфиг nginx.conf, собственный

##### 4) Проверил, что в браузере по localhost:81 отдается написанная вами страничка

![part3.4](images/part3.4.png)

Рис. 28 Проверка адреса в браузере

##### 5) Положил файл nginx.conf по пути ./nginx/nginx.conf (это понадобится позже)

## Part 4. Свой докер

#### Написал свой докер образ, который: 

##### 1) собирает исходники мини сервера на FastCgi из Части 3

##### 2) запускает его на 8080 порту

##### 3) копирует внутрь образа написанный ./nginx/nginx.conf

##### 4) запускает nginx.

![part4.1](images/part4.1.png)

Рис. 29 Докер образ

#### Собрал написанный докер образ через docker build при этом указав имя и тег

![part4.2](images/part4.2.png)

Рис. 30 Сборка докер образа

#### Проверил через docker images, что все собралось корректно

![part4.3](images/part4.3.png)

Рис. 31 Проверка на корректность сборки

#### Запустил собранный докер образ с маппингом 81 порта на 80 на локальной машине и маппингом папки ./nginx внутрь контейнера по адресу, где лежат конфигурационные файлы nginx'а (см. Часть 2)

![part4.4](images/part4.4.png)

Рис. 32 Запуск образа с маппингом

#### Проверил, что по localhost:80 доступна страничка написанного мини сервера

![part4.5](images/part4.5.png)

Рис. 33 Проверка по localhost:80

#### Дописал в ./nginx/nginx.conf проксирование странички /status, по которой надо отдавать статус сервера nginx

![part4.6](images/part4.6.png)

Рис. 34 Обновленный конфиг со страницей /status

#### Перезапустил докер образ

![part4.7](images/part4.7.png)

Рис. 35 Перезапуск докер образа

#### Проверить, что теперь по localhost:80/status отдается страничка со статусом nginx

![part4.8](images/part4.8.png)

Рис. 36 Проверка localhost:80/status

## Part 5. Dockle

#### Просканировал образ из предыдущего задания через dockle [image_id|repository]

![part5.1](images/part5.1.png)

Рис. 37 Cкан через dockle

#### Исправил образ так, чтобы при проверке через dockle не было ошибок и предупреждений

![part5.2](images/part5.2.png)

Рис. 38 Повторный скан исправенного образа

# ВАЖНО

### Dockle ругается на nginx-ключи, но они нужны для работы Докера. В этом задании, чтобы пройти проверку базовый образ был изменен на ubuntu, а затем обратно на nginx. В дальнейшем для прохождения проверок нужно при запуске dockle ставить исключение на nginx-ключи. Команда будет выглядеть так:

##### dockle -i CIS-DI-0010 *name:tag*

## Part 6. Базовый Docker Compose

#### Написал файл docker-compose.yml, с помощью которого:

##### 1) Поднял докер контейнер из Части 5

##### 2) Поднял докер контейнер с nginx, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера

![part6.1](images/part6.1.png)

Рис. 39 Файл docker-compose.yml на два контейнера с маппинг 8080 на 80 локалки

![part6.2](images/part6.2.png)

Рис. 40 Nginx конфиг с прокси с 8080 на 81

#### Замапил 8080 порт второго контейнера на 80 порт локальной машины (см. Рис. 39)

#### Остановил все запущенные контейнеры

![part6.3](images/part6.3.png)

Рис. 41 Все запущенные контейнеры остановлены

#### Собрал и запустил проект с помощью команд docker-compose build и docker-compose up

![part6.4](images/part6.4.png)

Рис. 42 Сборка и запуск проекта

#### Проверил, что в браузере по localhost:80 отдается написанная страничка, как и ранее

![part6.5](images/part6.5.png)

Рис. 43 Проверка localhost:80 по браузеру